<div id="content">
    <div id="waitCharge" *ngIf="checkSDLoading()">
        Por favor espera, Los datos se estan Cargando. Si notas latencia Informa a Cesar Gracia de TI
    </div>
    <table id="principalTable" *ngIf="!checkSDLoading()">
        <thead>
            <tr>
                <th>#</th>
                <th>Nombre de la Promocion</th>
                <th>Inicio y Fin de Promocion</th>
                <th>Datos Promocionales</th>
                <th>Enviar</th>
            </tr>
        </thead>
        <tbody>
            <tr id="getData" *ngFor="let row of rows; let i = index" [attr.id]="'row-' + (i + 1)">
                <td>{{ row.id+1 }}</td>
                <td>
                    <input type="text" name="_V1" [(ngModel)]="row._V1" 
                    placeholder="Ing. el Nombre para la promocion"/>
                </td> 
                <td>
                    <div>
                        <input type="date" name="_V2" [(ngModel)]="row._V2" />
                        <input type="date" name="_V3" [(ngModel)]="row._V3" />
                    </div>
                </td>    
                <td>
                    <button id="button">Seleccionar</button>
                </td>
                <td>
                    <button id="button">Enviar</button>
                </td>
            </tr>
            <tr class="mas" (click)="addRow()">
                <td>+</td>
                <td colspan="9"></td> <!-- Extiende la celda sobre las siguientes 9 columnas -->
            </tr>
            <!-- <tr id="getData" *ngFor="let row of rows; let i = index" [attr.id]="'row-' + (i + 1)" >
                <td>{{ row.id+1 }}</td>
                <td>
                    <select name="_V1" [(ngModel)]="row._V1" 
                    (ngModelChange)="getDataPLAN(row._V1, i);
                    getDataUpgrade(row._V1, row._V2, row._V3, i)">
                        <option value="">Elija el Servicio</option>
                        <option *ngFor=" let servicio of serviciosData" [value]="servicio" >{{servicio}}</option>
                    </select>
                </td>
                <td>
                    <select name="_V2" [(ngModel)]="row._V2" (ngModelChange)="getDataPLANVARIANT(row._V2, i);
                     getDataUpgrade(row._V1, row._V2, row._V3, i)">
                        <option value="">Elija un Plan</option>
                        <option value="" *ngIf="planData[i].length === 0 && !row._V1">Selecc. antes los otros elementos</option>
                        <option value="" *ngIf="planData[i].length === 0 && row._V1">Cargando Datos..</option>
                        <option *ngFor=" let plan of planData[i]" [value]="plan.TARIFFPLANID" >{{plan.TARIFFPLAN}}</option>    
                    </select>
                </td>
                <td>
                    <select name="_V3" [(ngModel)]="row._V3" 
                    (ngModelChange)="getDataPROD_CiudadesTariffplanVariantProducto(row._V3, row._V4, i);
                    getPrecioRegular(row._V3, row._V4, 0, i, 'NORMAL'); getDataUpgrade(row._V1, row._V2, row._V3, i)">
                        <option value="">Elija un Plan Variant</option>
                        <option value="" *ngIf="planVData[i].length === 0 && !row._V2">Selecc. antes los otros elementos</option>
                        <option value="" *ngIf="planVData[i].length === 0 && row._V2">Cargando Datos..</option>
                        <option *ngFor=" let planV of planVData[i]" [value]="planV.TARIFFPLANVARIANTID" >{{planV.TARIFFPLANVARIANT}}</option>    
                    </select>
                </td>
                <td>
                    <select name="_V4" [(ngModel)]="row._V4" (ngModelChange)="getPrecioRegular(row._V3, row._V4, 0, i, 'NORMAL');
                    getDataPROD_CiudadesTariffplanVariantProducto(row._V3, row._V4, i);">
                        <option value="">Elija un Producto</option>
                        <option value="" *ngIf="productosData[i].length === 0 && !row._V2">Selecc. antes los otros elementos</option>
                        <option value="" *ngIf="productosData[i].length === 0 && row._V2">Cargando Datos..</option>
                        <option *ngFor=" let prod of productosData[i]" [value]="prod.PRODUCTID" >{{prod.PRODUCTO}}</option>    
                    </select>
                </td>
                <td>
                    <button id="button" (click)="toggDD(i, 'MP')">Forma de Pago</button>
                    <div [ngClass]="{'show': showMDPDD[i], 'closing': closing}" class="dropdown">
                        <ul>
                            <li *ngFor="let mdpg of modoPagosData[i]">
                                <input type="checkbox" name="_V5" [(ngModel)]="mdpg.selected" [value]="mdpg.ID" />{{ mdpg.NAME }} 
                            </li>
                        </ul>
                    </div>
                </td>
                <td>
                    <button id="button" (click)="toggDD(i, 'B')">Buro de Credito</button>
                    <div [ngClass]="{'show': showBDD[i], 'closing': closing}" class="dropdown">
                        <ul>
                            <li *ngFor="let buro of buroData[i]">
                                <input type="checkbox" name="_V6" [(ngModel)]="buro.selected" [value]="buro.ID"/>{{buro.NAME}}
                            </li>
                        </ul>

                    </div>
                </td>
                <td>
                    <button id="button" name="_V7_V8" [disabled]="!button_V1_V6(row, i)" (click)="openModal(i,'CS')">Seleccionar</button>
                </td>
                <td>
                    <button id="button" name="_V9_V11" [disabled]="!button_V1_V8(row, i)" (click)="openModal(i, 'DP')">Elejir</button>
                    <button id="button" name="_V9_V11" (click)="openModal(i, 'DP')">Elejir</button>
                </td> -->
        </tbody>
    </table>
    <div *ngIf="modal_cs" class="modal_cs" [ngClass]="{'door-open': modal_cs}" id="modal_cs-{{ rowId+1 }}">
        <div class="modal-header">
            <span class="modal-title">Seleccionar Ciudades y Sectores - F# {{rowId+1}}</span>
            <button class="close-button" (click)="closeModal('CS')">×</button>
          </div>
        <div class="modal-body">
            <div id="content_ciudades_checklist">
                <div id="ciudades_checklist">
                    <span>Ciudades</span>
                    <ul>
                        <li *ngFor="let city of ciudadData[rowId]">
                            <input type="checkbox" [(ngModel)]="city.selected" [value]="city.CIUDAD_ID" />{{city.PROVINCIA}} - {{ city.CIUDAD }}
                        </li>
                    </ul>
                </div>
                <button id="button"[disabled]="!button_search_sect(rowId)" (click)="buscarSectores()">Buscar Sectores</button>
            </div>
            <div id="content_sectores_checklist">
                <div id="sectores_checklist">
                    <span>Sectores</span>
                    <ul>
                        <li *ngFor="let sect of sectoresData[rowId]">
                            <input type="checkbox" [(ngModel)]="sect.selected" [value]="sect.SECTOR_ID"/>{{sect.CIUDAD}} - {{sect.SECTOR}}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="modal_dp" class="modal_dp" [ngClass]="{'door-open': modal_dp}" id="modal_dp-{{rowId+1}}">
        <div class="modal-header">
          <span class="modal-title">Datos de Promocion - F# {{rowId+1}}</span>
          <button class="close-button" (click)="closeModal('DP')">×</button>
        </div>
        <div class="modal-body">
            <div id="dat_promo">
                <div id="dat_promo_ing">
                    <div id="precios" *ngFor="let precioRegular of precioRegularData[rowId]">
                        <div id="precio_content">
                            <span>
                                PRECIO REGULAR: ${{ precioRegular.PRECIO }}
                            </span>
                            <input id="precioRegular" name="_V9" [(ngModel)]="rows[rowId]._V9" 
                            type="number" [min]="1" [max]="precioRegular.PRECIO" 
                            (ngModelChange)="validatePrice($event, precioRegular.PRECIO, 'NORMAL')"
                            [class.invalid]="!validatePrice(rows[rowId]._V9, precioRegular.PRECIO, 'NORMAL')"/>
                        </div>
                        <div *ngIf="!vPR[rowId]['NORMAL']" class="error-message">
                            El precio promocional no puede superar el precio regular.
                        </div>
                    </div>

                    <div id="dias">
                        <span>DIAS GOZADOS</span>
                        <div id="checklist">
                            <ul>
                                <li *ngFor="let dias of diasGozadosData[rowId]">
                                    <input type="radio" name="_V10" [(ngModel)]="dias.selected" [value]="dias.NAME" /> {{dias.NAME}}
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div id="upgrade" *ngIf="upgradeData[rowId].length > 0">
                        <span>UPGRADE</span>
                        <select name="_V11" [(ngModel)]="rows[rowId]._V11">
                            <option value="">Selecciona un UPGRADE</option>
                            <option *ngFor=" let upgrade of upgradeData[rowId]" [value]="upgrade.ID" >{{upgrade.PLAN_UPGRADE}}</option>   
                        </select>
                    </div>
                </div>
                <div id="dat_promo_butt">
                    <div id="content_btn_dtpro_dropdown">
                        <button id="btn_dtpro_promo" (click)="toggDD(rowId, 'PA')" *ngIf="!visibleBtnPromocionAdicional[rowId]">Promoción Adicional</button>
                        <div [ngClass]="{'show': showPROAD[rowId], 'closing': closing}" class="dropdown">
                            <ul>
                                <li *ngFor="let op of optionsData[rowId]; let i = index">
                                    <input type="checkbox" [(ngModel)]="op.selected" (change)="updateSelection(rowId, i)" 
                                    (ngModelChange)="button_sendInformation(rowId, i)" [value]="op.name" />{{ op.name }} 
                                </li>
                            </ul>
                        </div>
                    </div>
                    <button id="btn_dtpro_send" [disabled]="!permitido[rowId]" (click)="sendInformation(rowId)">Enviar</button>
                </div>
            </div>
            <div id="pro_adici">
                <div id="streaming" *ngIf="optionsData[rowId][1].selected">
                    <div class="content_streaming"  *ngIf="tablesRow[rowId]?.length">
                        <label><strong>STREAMING #{{ selectedTable[rowId] + 1  }}</strong></label>
                        <table>
                            <tr>
                                <td><span>PAQUETE</span></td>
                                <td>
                                    <select name="PRAD_V1" [(ngModel)]="tablesRow[rowId][selectedTable[rowId]].PRAD_ST_V1"
                                    (ngModelChange)="getPrecioRegular(1000065, tablesRow[rowId][selectedTable[rowId]].PRAD_ST_V1, selectedTable[rowId], rowId, 'PA_STREAMING')">
                                        <option [value]="">PAQ. STREAMING</option>
                                        <option *ngFor="let plan of paquetesStreaming[rowId]" [value]="plan.TARIFFPLANVARIANTID">{{ plan.TARIFFPLANVARIANT }}</option>
                                    </select>
                                </td>
                            </tr>
                            <tr *ngFor="let precioRegular of precioRegularStreamingData[rowId][selectedTable[rowId]]">
                                <td>
                                    <span>PRE. REGULAR ${{ precioRegular.PRECIO }}</span>
                                </td>
                                <td>
                                    <div id="precio_content">                                    
                                        <input name="PRAD_ST_V2" [(ngModel)]="tablesRow[rowId][selectedTable[rowId]].PRAD_ST_V2" 
                                        placeholder="Ing. Pr. Promocional" type="number" min="1" [max]="precioRegular.PRECIO"
                                        (ngModelChange)="validatePrice($event, precioRegular.PRECIO, 'STREAMING')"
                                        [class.invalid]="!validatePrice(rows[rowId]._V9, precioRegular.PRECIO, 'STREAMING')"/>
                                    </div>
                                    <div *ngIf="!validatePrice(tablesRow[rowId][selectedTable[rowId]].PRAD_ST_V2, precioRegular.PRECIO, 'STREAMING')" class="error-message">
                                        El precio promocional no puede superar el precio regular.
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span>MES FINAL</span></td>
                                <td>
                                    <input name="PRAD_ST_V3" [(ngModel)]="tablesRow[rowId][selectedTable[rowId]].PRAD_ST_V3"
                                    type="number" [min]="2" [max]="24"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="streaming_items">
                        <button id="btn_new_table" (click)="addNewTable(rowId)">Nueva Tabla</button>
                        <select class="change_table" (change)="changeTable($event, rowId)">
                            <option>Cambiar de Tabla</option>
                            <option *ngFor="let table of tablesRow[rowId]; let i = index" [value]="i">Tabla {{ i + 1 }}</option>
                        </select>
                    </div>
                </div>
                <div id="telefonia" *ngIf="optionsData[rowId][2].selected">
                    <label><strong>TELEFONIA</strong></label>
                    <div id="content_telefonia">
                        <table>
                            <tr>
                                <td><span>PLANES</span></td>
                                <td>
                                    <select name="PRAD_TF_V1" [(ngModel)]="rows[rowId].PRAD_TF_V1"
                                    (ngModelChange)="getPrecioRegular(0, rows[rowId].PRAD_TF_V1, selectedTable[rowId], rowId, 'PA_TELEFONIA');
                                    validate(rows[rowId].PRAD_TF_V1, rows[rowId].PRAD_TF_V2, rows[rowId].PRAD_TF_V3, rows[rowId].PRAD_TF_V4, rowId, 'TELEFONIA')">
                                        <option [value]="">PLAN. TELEFONICO</option>
                                        <option *ngFor="let plan of planesTelefonicos[rowId]" [value]="plan.TARIFFPLANVARIANTID">{{ plan.TARIFFPLANVARIANT }}</option>
                                    </select>
                                </td>
                            </tr>
                            <tr *ngFor="let precioRegular of precioRegularTelefoniaData[rowId]">
                                <td>
                                    <span>PRE. REGULAR ${{precioRegular.PRECIO}}</span>
                                </td>
                                <td>
                                    <div id="precio_content">
                                        <input name="PRAD_TF_V2" placeholder="Ing. Pr. Promocional" type="number" min="1"[(ngModel)]="rows[rowId].PRAD_TF_V2"
                                        (ngModelChange)="validate(rows[rowId].PRAD_TF_V1, rows[rowId].PRAD_TF_V2, rows[rowId].PRAD_TF_V3, rows[rowId].PRAD_TF_V4, rowId, 'TELEFONIA')"
                                        (ngModelChange)="validatePrice($event, precioRegular.PRECIO, 'TELEFONIA')"
                                        [class.invalid]="!vPR[rowId]['TELEFONIA']"/>    
                                    </div>
                                    <div *ngIf="!vPR[rowId]['TELEFONIA']" class="error-message">
                                        El precio promocional no puede superar el precio regular.
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span>CANTIDAD</span></td>
                                <td>
                                    <input name="PRAD_TF_V3" type="number" [min]="1" [(ngModel)]="rows[rowId].PRAD_TF_V3"
                                    (ngModelChange)="validate(rows[rowId].PRAD_TF_V1, rows[rowId].PRAD_TF_V2, rows[rowId].PRAD_TF_V3, rows[rowId].PRAD_TF_V4, rowId, 'TELEFONIA')"/>
                                </td>
                            </tr>
                            <tr>
                                <td><span>MESES</span></td>
                                <td>
                                    <input name="PRAD_TF_V4" type="number"  [min]="2" [max]="24"[(ngModel)]="rows[rowId].PRAD_TF_V4"
                                    (ngModelChange)="validate(rows[rowId].PRAD_TF_V1, rows[rowId].PRAD_TF_V2, rows[rowId].PRAD_TF_V3, rows[rowId].PRAD_TF_V4, rowId, 'TELEFONIA')"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div id="television" *ngIf="optionsData[rowId][3].selected">
                    <label><strong>TELEVISION</strong></label>
                    <div id="content_television">
                        <table>
                            <tr>
                                <td><span>PLANES</span></td>
                                <td>
                                    <select name="PRAD_TV_V1" [(ngModel)]="rows[rowId].PRAD_TV_V1"
                                    (ngModelChange)="getPrecioRegular(darIdProducto(rowId), rows[rowId].PRAD_TV_V1, 0, rowId, 'PA_TELEVISION');
                                    validate(rows[rowId].PRAD_TV_V1, rows[rowId].PRAD_TV_V2, rows[rowId].PRAD_TV_V3, rows[rowId].PRAD_TV_V4, rowId, 'TELEVISION')">
                                        <option [value]="">PLAN. TELEVISION</option>
                                        <option *ngFor="let plan of planesTelevisivos[rowId]" [value]="plan.TARIFFPLANVARIANTID">{{ plan.TARIFFPLANVARIANT }}</option>
                                    </select>
                                </td>
                            </tr>
                            <tr *ngFor="let precioRegular of precioRegularTelevisioData[rowId]">
                                <td>
                                    <span>PRE. REGULAR ${{precioRegular.PRECIO}}</span>
                                </td>
                                <td>
                                    <div id="precio_content">
                                        <input name="PRAD_TV_V2" placeholder="Ing. Pr. Promocional" [(ngModel)]="rows[rowId].PRAD_TV_V2"
                                        type="number" [min]="1" (ngModelChange)="validate(rows[rowId].PRAD_TV_V1, rows[rowId].PRAD_TV_V2, rows[rowId].PRAD_TV_V3, rows[rowId].PRAD_TV_V4, rowId, 'TELEVISION')"   
                                        (ngModelChange)="validatePrice($event, precioRegular.PRECIO, 'TELEVISION')"
                                        [class.invalid]="!vPR[rowId]['TELEVISION']"/>    
                                    </div>
                                    <div *ngIf="!vPR[rowId]['TELEVISION']" class="error-message">
                                        El precio promocional no puede superar el precio regular.
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span>CANTIDAD</span></td>
                                <td>
                                    <input name="PRAD_TV_V3" type="number" [(ngModel)]="rows[rowId].PRAD_TV_V3" [min]="1" 
                                    (ngModelChange)="validate(rows[rowId].PRAD_TV_V1, rows[rowId].PRAD_TV_V2, rows[rowId].PRAD_TV_V3, rows[rowId].PRAD_TV_V4, rowId, 'TELEVISION')"/>
                                </td>
                            </tr>
                            <tr>
                                <td><span>MESES</span></td>
                                <td>
                                    <input name="PRAD_TV_V4" type="number" [min]="2" [max]="24" 
                                    [(ngModel)]="rows[rowId].PRAD_TV_V4"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div id="router" *ngIf="optionsData[rowId].length > 4 && optionsData[rowId][4].selected">
                    <label><strong>ROUTER</strong></label>
                    <div id="content_television">
                        <table>
                            <tr>
                                <td><span>ROUTER</span></td>
                                <td>
                                    <select name="PRAD_RT_V1" [(ngModel)]="rows[rowId].PRAD_RT_V1"
                                    (ngModelChange)="getPrecioRegular(rows[rowId].PRAD_RT_V1, rows[rowId]._V3, 0, rowId, 'PA_ROUTER');
                                    validate(rows[rowId].PRAD_RT_V1, rows[rowId].PRAD_RT_V2, rows[rowId].PRAD_RT_V3, rows[rowId].PRAD_RT_V4, rowId, 'ROUTER')">
                                        <option [value]="">MODELO ROUTER</option>
                                        <option *ngFor="let modelo of modelosRouter[rowId]" [value]="modelo.PRODUCTID">{{modelo.PRODUCTO}}</option>
                                    </select>
                                </td>
                            </tr>
                            <tr *ngFor="let precioRegular of precioRegularRouter[rowId]">
                                <td>
                                    <span>PRE. REGULAR ${{precioRegular.PRECIO}}</span>
                                </td>
                                <td>
                                    <div id="precio_content">
                                        <input name="PRAD_RT_V2"placeholder="Ing. Pr. Promocional" type="number" [min]="1"
                                        [max]="precioRegular.PRECIO" [(ngModel)]="rows[rowId].PRAD_RT_V2"
                                        (ngModelChange)="validate(rows[rowId].PRAD_RT_V1, rows[rowId].PRAD_RT_V2, rows[rowId].PRAD_RT_V3, rows[rowId].PRAD_RT_V4, rowId, 'ROUTER')"
                                        (ngModelChange)="validatePrice($event, precioRegular.PRECIO, 'ROUTER')"
                                        [class.invalid]="!vPR[rowId]['ROUTER']"/>    
                                    </div>
                                    <div *ngIf="!vPR[rowId]['ROUTER']" class="error-message">
                                        El precio promocional no puede superar el precio regular.
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span>CANTIDAD</span></td>
                                <td>
                                    <input name="PRAD_RT_V3" type="number" [min]="1" [(ngModel)]="rows[rowId].PRAD_RT_V3"
                                    (ngModelChange)="validate(rows[rowId].PRAD_RT_V1, rows[rowId].PRAD_RT_V2, rows[rowId].PRAD_RT_V3, rows[rowId].PRAD_RT_V4, rowId, 'ROUTER')"/>
                                </td>
                            </tr>
                            <tr>
                                <td><span>MESES</span></td>
                                <td>
                                    <input name="PRAD_RT_V4" type="number" [min]="2" [max]="24" 
                                    [(ngModel)]="rows[rowId].PRAD_RT_V4"
                                    (ngModelChange)="validate(rows[rowId].PRAD_RT_V1, rows[rowId].PRAD_RT_V2, rows[rowId].PRAD_RT_V3, rows[rowId].PRAD_RT_V4, rowId, 'ROUTER')"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>